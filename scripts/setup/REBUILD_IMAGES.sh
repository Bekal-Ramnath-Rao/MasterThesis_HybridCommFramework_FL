#!/bin/bash

# ============================================================================
# DEPENDENCY FIX VERIFICATION & REBUILD COMMANDS
# ============================================================================
# Run these commands to verify the comprehensive dependency fix and
# rebuild all Docker images with proper dependency resolution.
# ============================================================================

PROJECT_DIR="/home/ubuntu/Desktop/MT_Ramnath/MasterThesis_HybridCommFramework_FL"

echo "==============================================="
echo "ðŸ“‹ DEPENDENCY FIX SUMMARY"
echo "==============================================="
echo ""
echo "âœ… Fixed Issues:"
echo "  1. Added pytz (pandas timezone support)"
echo "  2. Added python-dateutil (pandas datetime support)"
echo "  3. Added Pillow (matplotlib image support)"
echo "  4. Removed --no-deps flag from pip (enables auto-dependency resolution)"
echo ""
echo "âœ… Files Modified:"
echo "  - requirements.txt (added missing dependencies)"
echo "  - Server/Dockerfile (removed --no-deps)"
echo "  - Client/Dockerfile (removed --no-deps)"
echo ""
echo "==============================================="
echo "ðŸ”¨ REBUILD ALL IMAGES"
echo "==============================================="
echo ""
echo "# Option 1: Rebuild all images (recommended)"
echo "cd $PROJECT_DIR/Docker"
echo "docker compose -f docker-compose-emotion.yml build"
echo "docker compose -f docker-compose-mentalstate.yml build"
echo "docker compose -f docker-compose-temperature.yml build"
echo ""
echo "# Option 2: Force rebuild without cache (slower but guarantees fresh build)"
echo "cd $PROJECT_DIR/Docker"
echo "docker compose -f docker-compose-emotion.yml build --no-cache"
echo "docker compose -f docker-compose-mentalstate.yml build --no-cache"
echo "docker compose -f docker-compose-temperature.yml build --no-cache"
echo ""
echo "# Option 3: Use automated build script"
echo "bash $PROJECT_DIR/build_and_test.sh"
echo ""
echo "==============================================="
echo "ðŸ§ª TEST EXPERIMENTS"
echo "==============================================="
echo ""
echo "# Quick test (2 rounds, 1 protocol, 1 scenario)"
echo "cd $PROJECT_DIR"
echo "python3 Network_Simulation/run_network_experiments.py --use-case emotion --enable-gpu --single --protocol mqtt --scenario excellent --rounds 2"
echo ""
echo "# Full test all protocols for emotion (2 rounds)"
echo "python3 Network_Simulation/run_network_experiments.py --use-case emotion --enable-gpu --rounds 2"
echo ""
echo "# Full test all 3 use cases (10 rounds, ~6-12 hours)"
echo "for use_case in emotion mentalstate temperature; do"
echo "  python3 Network_Simulation/run_network_experiments.py --use-case \$use_case --enable-gpu --rounds 10"
echo "done"
echo ""
echo "==============================================="
echo "âœ… VERIFICATION COMMANDS"
echo "==============================================="
echo ""
echo "# Verify pip installed dependencies in container"
echo "docker exec fl-server-mqtt-emotion pip list | grep -E 'pandas|matplotlib|pytz|dateutil|Pillow'"
echo ""
echo "# Verify imports work in container"
echo "docker exec fl-server-mqtt-emotion python -c \"import pandas; import matplotlib.pyplot; print('âœ… All imports successful')\""
echo ""
echo "# Verify GPU detection"
echo "docker exec fl-server-mqtt-emotion python -c \"import tensorflow as tf; print('GPUs:', tf.config.list_physical_devices('GPU'))\""
echo ""
echo "==============================================="
echo "ðŸ“Š RESULTS LOCATION"
echo "==============================================="
echo ""
echo "Results saved in: $PROJECT_DIR/experiment_results/"
echo "Folder pattern: {use_case}_{YYYYMMDD_HHMMSS}/"
echo ""
echo "==============================================="
